<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ title }} - Админ-панель СК "Вершина"</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='admin_style.css') }}">
  <style>
    /* Небольшие точечные стили только для инструментов таблицы */
    .table-tools{
      display:flex; gap:12px; align-items:center; margin:10px 0 14px;
      flex-wrap:wrap;
    }
    .table-tools .grow{ flex:1 1 260px; }
    .muted{ color:#6c757d; font-size:.9em; }
  </style>
</head>
<body>
  <div class="admin-container">
    <nav class="admin-nav" aria-label="Административная навигация">
      <a href="{{ url_for('admin_coaches_list') }}" aria-current="page">Управление тренерами</a>
      <a href="{{ url_for('admin_services_list') }}">Управление услугами</a>
      <a href="{{ url_for('admin_news_list') }}">Управление новостями</a>
      <a href="{{ url_for('admin_courses_list') }}">Управление курсами</a>
      <a href="{{ url_for('index') }}" style="margin-left:auto;">На главный сайт</a>
    </nav>

    <h1>{{ title }}</h1>

    <div class="table-tools" role="region" aria-label="Инструменты списка тренеров">
      <a href="{{ url_for('admin_add_coach') }}" class="add-button">Добавить тренера</a>
      <a href="{{ url_for('admin_add_service') }}" class="add-button">Добавить услугу</a>

      <input id="filterInput" class="grow" type="text" placeholder="Поиск: имя или специализация…"
             aria-label="Поиск по имени или специализации">
      <select id="sectionFilter" aria-label="Фильтр по секции">
        <option value="">Все секции</option>
        <option value="Горнолыжная база">Горнолыжная база</option>
        <option value="Тренажерный зал">Тренажерный зал</option>
      </select>

      <span class="muted" id="rowsCount" aria-live="polite"></span>
    </div>

    {% if coaches %}
      <table class="admin-table" aria-describedby="rowsCount">
        <thead>
          <tr>
            <th scope="col">ID</th>
            <th scope="col">Фото</th>
            <th scope="col">Имя</th>
            <th scope="col">Секция</th>
            <th scope="col">Специализация</th>
            <th scope="col">Действия</th>
          </tr>
        </thead>
        <tbody>
          {% for coach in coaches %}
          <tr>
            <td>{{ coach.id }}</td>
            <td>
              {% if coach.photo_path %}
                <img src="{{ media_url(coach.photo_path) }}"
                     alt="Фото: {{ coach.name }}"
                     width="50" height="50"
                     style="border-radius:50%; object-fit:cover;"
                     loading="lazy">
              {% else %}
                <span class="muted">Нет фото</span>
              {% endif %}
            </td>
            <td>{{ coach.name }}</td>
            <td>{{ 'Горнолыжная база' if coach.section == 'ski' else 'Тренажерный зал' }}</td>
            <td>{{ coach.specialization if coach.specialization else '—' }}</td>
            <td class="admin-actions">
              <a href="{{ url_for('admin_edit_coach', coach_id=coach.id) }}" class="edit-button" title="Редактировать">Ред.</a>
              <form method="POST"
                    action="{{ url_for('admin_delete_coach', coach_id=coach.id) }}"
                    style="display:inline;"
                    onsubmit="return confirm('Удалить тренера ' + {{ coach.name|tojson }} + '? Это действие необратимо.');">
                <button type="submit" class="delete-button" aria-label="Удалить тренера {{ coach.name }}">Удал.</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p>Пока нет ни одного тренера в базе данных. Нажмите «Добавить тренера», чтобы начать.</p>
    {% endif %}
  </div>

  <script>
    // Простой клиентский поиск/фильтр без изменений бэка
    (function () {
      const input = document.getElementById('filterInput');
      const select = document.getElementById('sectionFilter');
      const tbody = document.querySelector('.admin-table tbody');
      const counter = document.getElementById('rowsCount');
      if (!tbody) return;

      const rows = Array.from(tbody.querySelectorAll('tr'));
      function normalize(s){ return (s || '').toLowerCase().trim(); }

      function applyFilters(){
        const q = normalize(input.value);
        const sec = select.value; // Пусто = все

        let visible = 0;
        rows.forEach(tr => {
          const cells = tr.children;
          const name = normalize(cells[2]?.textContent);
          const section = (cells[3]?.textContent || '').trim();
          const spec = normalize(cells[4]?.textContent);

          const textMatch = !q || name.includes(q) || spec.includes(q);
          const sectionMatch = !sec || section === sec;

          const show = textMatch && sectionMatch;
          tr.style.display = show ? '' : 'none';
          if (show) visible++;
        });

        counter.textContent = `Показано: ${visible} из ${rows.length}`;
      }

      input.addEventListener('input', applyFilters);
      select.addEventListener('change', applyFilters);
      applyFilters();
    })();
  </script>
</body>
</html>



