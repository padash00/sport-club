<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>{{ title }} - Админ-панель СК "Вершина"</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="{{ url_for('static', filename='admin_style.css') }}">
  <style>
    .table-tools{display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin:10px 0 16px}
    .table-tools .grow{flex:1 1 260px}
    .muted{color:#6c757d;font-size:.9em}
    .thumb{width:90px;height:60px;object-fit:cover;border-radius:4px;border:1px solid #dee2e6}
    .nowrap{white-space:nowrap}
  </style>
</head>
<body>
  <div class="admin-container">
    <nav class="admin-nav" aria-label="Административная навигация">
      <a href="{{ url_for('admin_courses_list') }}" aria-current="page">Управление курсами</a>
      <a href="{{ url_for('admin_coaches_list') }}">Управление тренерами</a>
      <a href="{{ url_for('admin_services_list') }}">Управление услугами</a>
      <a href="{{ url_for('admin_news_list') }}">Управление новостями</a>
      <a href="{{ url_for('index') }}" style="margin-left:auto;">На главный сайт</a>
    </nav>

    <h1>{{ title }}</h1>

    <div class="table-tools" role="region" aria-label="Инструменты списка курсов">
      <a class="add-button" href="{{ url_for('admin_add_course') }}">Добавить курс</a>
      <input id="filterInput" class="grow" type="text" placeholder="Поиск по названию…" aria-label="Поиск по названию курса">
      <span class="muted" id="rowsCount" aria-live="polite"></span>
    </div>

    {% if courses %}
      <table class="admin-table" aria-describedby="rowsCount">
        <thead>
          <tr>
            <th scope="col">ID</th>
            <th scope="col">Превью</th>
            <th scope="col">Название</th>
            <th scope="col" class="nowrap">YouTube ID</th>
            <th scope="col">Ссылки</th>
            <th scope="col">Действия</th>
          </tr>
        </thead>
        <tbody>
          {% for c in courses %}
          <tr>
            <td>{{ c.id }}</td>
            <td>
              <img
                class="thumb"
                src="https://img.youtube.com/vi/{{ c.youtube_id }}/hqdefault.jpg"
                alt="Превью: {{ c.title }}"
                loading="lazy" width="90" height="60">
            </td>
            <td>{{ c.title }}</td>
            <td class="nowrap">{{ c.youtube_id }}</td>
            <td class="muted">
              <a href="https://www.youtube.com/watch?v={{ c.youtube_id }}" target="_blank" rel="noopener">Открыть на YouTube</a><br>
              <a href="{{ url_for('courses') }}" target="_blank" rel="noopener">Открыть на сайте</a>
            </td>
            <td class="admin-actions">
              <a class="edit-button"
                 href="{{ url_for('admin_edit_course', course_id=c.id) }}"
                 title="Редактировать курс">Ред.</a>

              <form method="POST"
                    action="{{ url_for('admin_delete_course', course_id=c.id) }}"
                    style="display:inline;"
                    onsubmit="return confirm('Удалить курс «{{ c.title }}»? Это действие необратимо.');">
                <button type="submit" class="delete-button" aria-label="Удалить курс {{ c.title }}">Удал.</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p>Курсов пока нет. Нажмите «Добавить курс», чтобы создать первый.</p>
    {% endif %}
  </div>

  <script>
    // Простой фильтр по названию + счётчик строк
    (function(){
      const input = document.getElementById('filterInput');
      const tbody = document.querySelector('.admin-table tbody');
      const counter = document.getElementById('rowsCount');
      if (!tbody) return;

      const rows = Array.from(tbody.querySelectorAll('tr'));
      const norm = s => (s||'').toLowerCase().trim();

      function apply(){
        const q = norm(input.value);
        let visible = 0;
        rows.forEach(tr=>{
          const title = norm(tr.children[2]?.textContent);
          const show = !q || title.includes(q);
          tr.style.display = show ? '' : 'none';
          if (show) visible++;
        });
        counter.textContent = `Показано: ${visible} из ${rows.length}`;
      }

      input.addEventListener('input', apply);
      apply();
    })();
  </script>
</body>
</html>
