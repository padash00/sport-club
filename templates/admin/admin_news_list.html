<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>{{ title }} - Админ-панель СК "Вершина"</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="{{ url_for('static', filename='admin_style.css') }}">
  <style>
    /* точечные стили для инструментов списка */
    .table-tools{display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin:10px 0 16px}
    .table-tools .grow{flex:1 1 260px}
    .muted{color:#6c757d;font-size:.9em}
    .thumb{width:70px;height:50px;object-fit:cover;border-radius:3px}
  </style>
</head>
<body>
  <div class="admin-container">
    <nav class="admin-nav" aria-label="Административная навигация">
      <a href="{{ url_for('admin_coaches_list') }}">Управление тренерами</a>
      <a href="{{ url_for('admin_services_list') }}">Управление услугами</a>
      <a href="{{ url_for('admin_news_list') }}" aria-current="page">Управление новостями</a>
      <a href="{{ url_for('index') }}" style="margin-left:auto;">На главный сайт</a>
    </nav>

    <h1>{{ title }}</h1>

    <div class="table-tools" role="region" aria-label="Инструменты списка новостей">
      <a href="{{ url_for('admin_add_news') }}" class="add-button">Добавить новость</a>

      <input id="filterInput" class="grow" type="text"
             placeholder="Поиск по заголовку…"
             aria-label="Поиск по заголовку новости">
      <label class="muted" style="display:flex;align-items:center;gap:6px;">
        <input type="checkbox" id="withImage">
        только с картинкой
      </label>
      <span class="muted" id="rowsCount" aria-live="polite"></span>
    </div>

    {% if articles %}
      <table class="admin-table" aria-describedby="rowsCount">
        <thead>
          <tr>
            <th scope="col">ID</th>
            <th scope="col">Картинка</th>
            <th scope="col">Заголовок</th>
            <th scope="col">Дата публикации</th>
            <th scope="col">Действия</th>
          </tr>
        </thead>
        <tbody>
          {% for article in articles %}
          <tr data-hasimg="{{ '1' if article.image_path else '0' }}">
            <td>{{ article.id }}</td>
            <td>
              {% if article.image_path %}
                <img
                  class="thumb"
                  src="{{ media_url(article.image_path) }}"
                  alt="Изображение: {{ article.title }}"
                  loading="lazy" width="70" height="50">
              {% else %}
                <span class="muted">Нет</span>
              {% endif %}
            </td>
            <td>
              {{ article.title }}
              <div class="muted">
                <a href="{{ url_for('news_article_detail', article_id=article.id) }}" target="_blank" rel="noopener">Открыть на сайте</a>
              </div>
            </td>
            <td>
              {% if article.pub_date %}
                <time datetime="{{ article.pub_date.isoformat() }}">
                  {{ article.pub_date.strftime('%d.%m.%Y %H:%M') }}
                </time>
              {% else %}
                <span class="muted">Нет даты</span>
              {% endif %}
            </td>
            <td class="admin-actions">
              <a href="{{ url_for('admin_edit_news', article_id=article.id) }}" class="edit-button" title="Редактировать новость">Ред.</a>
              <form method="POST"
                    action="{{ url_for('admin_delete_news', article_id=article.id) }}"
                    style="display:inline;"
                    onsubmit="return confirm('Удалить новость «{{ article.title }}»? Это действие необратимо.');">
                <button type="submit" class="delete-button" aria-label="Удалить новость {{ article.title }}">Удал.</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p>Новостей пока нет. Нажмите «Добавить новость», чтобы создать первую.</p>
    {% endif %}
  </div>

  <script>
    // Фильтр по заголовку + «только с картинкой»
    (function(){
      const input = document.getElementById('filterInput');
      const withImg = document.getElementById('withImage');
      const tbody = document.querySelector('.admin-table tbody');
      const counter = document.getElementById('rowsCount');
      if (!tbody) return;

      const rows = Array.from(tbody.querySelectorAll('tr'));
      const normalize = s => (s||'').toLowerCase().trim();

      function apply(){
        const q = normalize(input.value);
        const imgOnly = withImg.checked;
        let visible = 0;

        rows.forEach(tr => {
          const titleCell = tr.children[2];
          const hasImg = tr.getAttribute('data-hasimg') === '1';
          const textMatch = !q || normalize(titleCell?.textContent).includes(q);
          const imgMatch = !imgOnly || hasImg;
          const show = textMatch && imgMatch;
          tr.style.display = show ? '' : 'none';
          if (show) visible++;
        });

        counter.textContent = `Показано: ${visible} из ${rows.length}`;
      }

      input.addEventListener('input', apply);
      withImg.addEventListener('change', apply);
      apply();
    })();
  </script>
</body>
</html>

